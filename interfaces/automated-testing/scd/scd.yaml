openapi: 3.0.2
info:
  title: Strategic Coordination Test Data Injection
  version: 0.0.1
  description: >-
    This interface is implemented by every USS wishing to be tested by the automated testing framework.
    The automated testing suite calls this interface to inject test data into the USS system under test.

components:
  securitySchemes:
    Authority:
      type: oauth2
      flows:
        clientCredentials:
          tokenUrl: https://auth.example.com/oauth/token
          scopes:
            utm.inject_test_data: |-
              Client may inject test data into a USS for the purpose of conducting automated tests.
      description: |-
        Authorization from, or on behalf of, an authorization authority, augmenting standard scd authorization for the purpose of automated testing.

  schemas:
    StatusResponse:
      type: object
      required:
        - status
      properties:
        status:
          description: >-
            The status of the USS automated testing interface.

            - `Starting`: the USS is starting and the automated test driver should wait before sending requests.

            - `Ready`: the USS is ready to receive test requests.
          type: string
          enum: [Starting, Ready]
          example: Ready

    InjectFlightResponse:
      type: object
      required:
        - result
      properties: 
        result: 
          description: >-
            The result of the flight submission

              - `Planned`: The flight submission data was valid and the flight was successfully processed by the USS and is now authorized.

              - `Rejected`: The flight submission data provided was invalid and/or could not be used to attempt to authorize the flight.

              - `ConflictWithFlight`: The flight submission data was valid, but the flight could not be authorized because of a disallowed conflict with another flight.

              - `Failed`: The USS was not able to successfully authorize the flight due to a problem with the USS or a downstream system

          type: string
          enum: [Planned, Rejected, ConflictWithFlight, Failed]
          example: Planned

paths:
  /v1/status:
    get:
      security:
        - Authority:
            - utm.inject_test_data
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
          description: >-
            The USS automated testing interface is activated and its status was retrieved successfully.
        '401':
          description: Bearer access token was not provided in Authorization header, token could not be decoded, or token was invalid.
        '403':
          description: The access token was decoded successfully but did not include a scope appropriate to this endpoint.
        '404':
          description: The USS automated testing interface is not activated.
      summary: Retrieve the status of the USS automated testing interface
      description: Get the status of the USS automated testing interface

  /v1/flights/{flight_id}:    
    put:      
      # TODO: Add the details of a requestBody for this endpoint
      security:
        - Authority:
            - utm.inject_test_data
      parameters:
        - name: flight_id
          in: path
          required: true
          description: A UUID string identifying the injected flight.
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InjectFlightResponse'
          description: Requested data was processed successfully
        '401':
          description: Bearer access token was not provided in Authorization header, token could not be decoded, or token was invalid.
        '403':
          description: The access token was decoded successfully but did not include a scope appropriate to this endpoint.

      summary: Inject test flight
      description: >-
        This endpoint simulates the operator intention to submit a flight operation / flight request.