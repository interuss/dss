// This file was automatically generated by terraform-commons-dss.
// Do not edit it directly.
local dss = import '../../dss.libsonnet';
local metadataBase = import '../../metadata_base.libsonnet';

// All VAR_* values below must be replaced with appropriate values; see
// dss/build/README.md for more information.

local metadata = metadataBase {
  namespace: '${VAR_NAMESPACE}',
  clusterName: '${VAR_CLUSTER_CONTEXT}',
  single_cluster: false,
  enableScd: ${VAR_ENABLE_SCD}, // <-- This boolean value is VAR_ENABLE_SCD
  datastore: '${VAR_DATASTORE}',
  locality: '${VAR_LOCALITY}',
  cockroach+: {
    image: '${VAR_CRDB_DOCKER_IMAGE_NAME}',
    hostnameSuffix: '${VAR_DB_HOSTNAME_SUFFIX}',
    nodeIPs: [${VAR_CRDB_NODE_IPS}],
    shouldInit: ${VAR_SHOULD_INIT},
    JoinExisting: [${VAR_CRDB_EXTERNAL_NODES}],
    storageClass: '${VAR_STORAGE_CLASS}',
    clusterName: '${VAR_CRDB_CLUSTER_NAME}',
  },
  yugabyte+: {
    image: '${VAR_YUGABYTE_DOCKER_IMAGE_NAME}',
    masterNodeIPs: [${VAR_YUGABYTE_MASTER_NODE_IPS}],
    tserverNodeIPs: [${VAR_YUGABYTE_TSERVER_NODE_IPS}],
    masterAddresses: [${VAR_YUGABYTE_MASTER_ADDRESSES}],
    master: {
      rpc_bind_addresses: '${VAR_YUGABYTE_MASTER_BIND_ADDRESS}',
      server_broadcast_addresses: '${VAR_YUGABYTE_MASTER_BIND_ADDRESS}',
    },
    tserver: {
      rpc_bind_addresses: '${VAR_YUGABYTE_TSERVER_BIND_ADDRESS}',
      server_broadcast_addresses: '${VAR_YUGABYTE_TSERVER_BIND_ADDRESS}',
    },
    placement: {
      cloud: '${VAR_YUGABYTE_CLOUD}',
      region: '${VAR_YUGABYTE_REGION}',
      zone: '${VAR_YUGABYTE_ZONE}',
    },
    storageClass: '${VAR_STORAGE_CLASS}',
    fix_27367_issue: true,
    light_resources: ${VAR_YUGABYTE_LIGHT_RESOURCES},
  },
  backend+: {
    ipName: '${VAR_INGRESS_NAME}',
    %{if VAR_CLOUD_PROVIDER == "aws"}
    certName: '${VAR_CERT_NAME}',
    %{endif}
    image: '${VAR_DOCKER_IMAGE_NAME}',
    pubKeys: ['${VAR_PUBLIC_KEY_PEM_PATH}'],
    jwksEndpoint: '${VAR_JWKS_ENDPOINT}',
    jwksKeyIds: ['${VAR_JWKS_KEY_ID}'],
    hostname: '${VAR_APP_HOSTNAME}',
    publicEndpoint: 'https://${VAR_APP_HOSTNAME}',
    dumpRequests: false,
    sslPolicy: '${VAR_SSL_POLICY}'
  },
  schema_manager+: {
    enable: true,
    image: '${VAR_DOCKER_IMAGE_NAME}',
    desired_rid_db_version: '${VAR_DESIRED_RID_DB_VERSION}',
    desired_scd_db_version: '${VAR_DESIRED_SCD_DB_VERSION}',
    desired_aux_db_version: '${VAR_DESIRED_AUX_DB_VERSION}',
  },
  evict+: {
    scd+: {
      enable_cron: ${VAR_EVICT_ENABLE_SCD_CRON},
      schedule: "${VAR_EVICT_SCD_SCHEDULE}",
      ttl: "${VAR_EVICT_SCD_TTL}",
      operational_intents: ${VAR_EVICT_SCD_ENABLE_OPERATIONAL_INTENTS},
      subscriptions: ${VAR_EVICT_SCD_ENABLE_SUBSCRIPTIONS},
    },
    rid+: {
      enable_cron: ${VAR_EVICT_ENABLE_RID_CRON},
      schedule: "${VAR_EVICT_RID_SCHEDULE}",
      ttl: "${VAR_EVICT_RID_TTL}",
      ISAs: ${VAR_EVICT_RID_ENABLE_ISAS},
      subscriptions: ${VAR_EVICT_RID_ENABLE_SUBSCRIPTIONS},
    },
  },
  prometheus+: {
    storageClass: '${VAR_STORAGE_CLASS}',
    expose_external: ${VAR_PROMETHEUS_EXPOSE_EXTERNAL},
    IP: '${VAR_PROMETHEUS_IP}',
  },
  image_pull_secret: '${VAR_DOCKER_IMAGE_PULL_SECRET}',
  cloud_provider: '${VAR_CLOUD_PROVIDER}',
  %{if VAR_CLOUD_PROVIDER == "aws"}
  subnet: '${VAR_SUBNET}',
  %{endif}
};

dss.all(metadata)
